// Generated by CoffeeScript 2.3.2
(function() {
  var IO, admin_group, app, http, io, server, user_group;

  http = require('http');

  IO = require('socket.io');

  app = require('../app.js');

  server = http.Server(app);

  io = IO(server);

  // admin_group's client page (route) is /admin/daka
  admin_group = io.of('/admin').on('connect', function(socket) {
    return socket.send('Good News For Administrators.');
  });

  admin_group.on('png ready', function() {
    return user_group.emit('admin qr ready', 'goto url:/has/png/qrcode');
  });

  // user page(client):/user/daka
  user_group = io.of('/user').on('connect', function(socket) {
    return socket.send('Good News For Users.');
  });

  user_group.on('query qr', function(userid) {
    // user in client page send requery for daka
    // server emit and client side .on 'show qrcode' - /admin/daka
    return admin_group.emit('qr ready', 'transfer from' + userid);
  });

  io.on('connect', function(socket) {
    socket.send('hi every body.');
    socket.on('createqrcode', function(text, cb) {
      // client query a qrcode
      return cb('/create-qrcode?text=' + text);
    });
    return socket.on('disconnect', function() {
      return console.log('one user leave.');
    });
  });

  server.listen(3003, function() {
    return console.log('server running at port 3003;press Ctrl-C to terminate.');
  });

}).call(this);
