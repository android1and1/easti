// Generated by CoffeeScript 2.3.2
(function() {
  $(function() {
    var $box, $img, socket;
    // 2019-3-2(1?) Manman went to school alone,but she didn't fell lonely.
    // 说说对SIO编程中最难理解的概念SOCKET的理解。
    // server-socket,client-socket(in this case) means difference,in server side socket is 2 plugins and 1 line.socket.on is real
    // listener,whereas,the channel(namespace)'s .on definition is not work about message(object) transfer.but it can .emit() to 
    // all listeners in client.
    // client-socket,its .on and .emit act as point-to-point suit,it is a 'shuang gong' mechemst.
    $box = $('ol#box');
    $img = $box.find('img');
    if (!io) {
      $box.append('<h1> IO Server Not Connect,Detect Enviroment</h1>');
    }
    socket = io('/admin');
    socket.on('message', function(msg) {
      $box.append($('<li/>', {
        text: msg
      }));
      return $box.append($('<li/>', {
        text: 'in admin,socket id=' + socket.id
      }));
    });
    return socket.on('fetch qr', function(seedobj) {
      var querystring, socketid;
      // display a png qrcode for users 'daka'
      socketid = seedobj.socketid.replace('#', '');
      querystring = '?socketid=' + socketid;
      querystring += '&&timestamp=' + seedobj.timestamp;
      querystring += '&&alias=' + seedobj.alias;
      $img.attr('src', seedobj.url + querystring);
      $box.append($('<li/>', {
        text: 'Query String:' + querystring
      }));
      $box.append($('<li/>', {
        text: seedobj.socketid + ' dakaing'
      }));
      return socket.emit('qr fetched', socket.id);
    });
  });

}).call(this);
