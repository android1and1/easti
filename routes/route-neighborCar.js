// Generated by CoffeeScript 2.3.1
(function() {
  // 2018-12-19 game is "5min=1app".
  var client, express, neighborCarFactory, nohm, router;

  express = require('express');

  router = express.Router();

  nohm = void 0;

  client = (require('redis')).createClient();

  client.on('error', function(error) {
    return console.log('::debug info - route neighborCar::', error.message);
  });

  client.on('connect', function() {
    var md;
    md = require('../modules/md-neighborCar');
    nohm = (require('nohm')).Nohm;
    nohm.setPrefix('wiki');
    nohm.setClient(this);
    return nohm.register(md);
  });

  // till here,has 'global' variable - '' 
  router.get('/', function(req, res, next) {
    return res.send('i am neighbor car router.');
  });

  router.get('/register-car', function(req, res, next) {
    return res.render('neighborCar/register-car.pug', {
      title: 'Register Car(Neighbors)'
    });
  });

  router.post('/register-car', async function(req, res, next) {
    var error, ins;
    ins = (await nohm.factory('neighborCar'));
    ins.property({
      brand: 'tokyo',
      licence_number: '1a44b',
      color: 'white',
      vehicle_model: 'yueye',
      whatistime: '2017-11-2 18:04:19',
      memo: 'a man within a black coat.'
    });
    try {
      await ins.save();
    } catch (error1) {
      error = error1;
      console.log(ins.errors);
      res.send('save failed.');
    }
    return res.send('saved.');
  });

  neighborCarFactory = function(app) {
    return function(pathname) {
      return app.use(pathname, router);
    };
  };

  module.exports = neighborCarFactory;

}).call(this);
