// Generated by CoffeeScript 2.3.1
(function() {
  var express, formidable, router;

  express = require('express');

  router = express.Router();

  formidable = require('formidable');

  router.get('/iphone-uploading', function(req, res, next) {
    return res.render('uploading/iphone-uploading');
  });

  router.post('/iphone-uploading', function(req, res, next) {
    var form, ifred;
    form = new formidable.IncomingForm;
    form.uploadDir = './tmp';
    form.multiples = true;
    ifred = false;
    form.on('file', function(name, file) {
      console.log('-------');
      console.log(file.name, file.path);
      return console.log('-------');
    });
    return form.parse(req, function(err, fields, files) {
      if (err) {
        return res.render('uploading/error.pug');
      } else {
        /*
         * check server side received
        upload_fields_info = '<p>fields["specof"]: ' +  fields["specof"] + '</p>' 
        upload_files_info = '' 
        for v,i in files["choicefiles"]  # it is a list
          upload_files_info += '<p>files["choicefiles"][' +  (i+1) + '] ' + v.name + '</p>'
        res.send upload_fields_info + upload_files_info
         */
        return res.redirect(302, '/uploading/successfully'); // 302 is default code.
      }
    });
  });

  router.get('/successfully', function(req, res, next) {
    return res.render('uploading/successfully', {
      title: 'iphone-uploading-success'
    });
  });

  module.exports = router;

}).call(this);
