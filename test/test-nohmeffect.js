// Generated by CoffeeScript 2.1.1
(function() {
  var assert, nohm, redis, schema;

  assert = require('assert');

  redis = require('redis').createClient();

  nohm = require('nohm').Nohm;

  schema = nohm.model('trythem', {
    idGenerator: 'increment',
    properties: {
      tryabout: {
        type: 'string',
        validations: ['notEmpty'],
        unique: true
      },
      trycontent: {
        type: 'string',
        validations: ['notEmpty']
      },
      trymoment: {
        type: 'timestamp',
        defaultValue: Date.parse(new Date)
      },
      tryvisits: {
        type: 'integer',
        index: true,
        defaultValue: 0
      }
    }
  });

  describe('custom function try test::', function() {
    before(async function() {
      var db, error;
      nohm.setPrefix('tryNohm');
      nohm.setClient(redis);
      db = (await nohm.factory('trythem'));
      db.property('tryabout', 'story1');
      db.property('trycontent', 'long long ago\nthere was a ..\n');
      db.property('tryvisits', 2222);
      try {
        return db.save();
      } catch (error1) {
        error = error1;
        return Promise.resolved('be catched:::' + error);
      }
    });
    after(function() {
      // clean all,via node-redis
      return redis.keys('*', function(err, keylist) {
        var i, key, len, results;
        results = [];
        for (i = 0, len = keylist.length; i < len; i++) {
          key = keylist[i];
          results.push(redis.del(key));
        }
        return results;
      });
    });
    it('should create 1 item::', async function() {
      var db, ids;
      // find() will list all items.
      db = (await nohm.factory('trythem'));
      ids = (await db.find());
      return assert.equal(ids.length, 1);
    });
    return it('should correct attribute of saved object::', async function() {
      var db;
      db = (await nohm.factory('trythem'));
      return db.load(1).then(function(something) {
        return assert.equal(something.tryvisits, 2222);
      });
    });
  });

  // or
//assert.equal db.allProperties().tryvisits,2222

}).call(this);
